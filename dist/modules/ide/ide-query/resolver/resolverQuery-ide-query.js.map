{"version":3,"sources":["../../../../../src/modules/ide/ide-query/resolver/resolverQuery-ide-query.js"],"names":["fs","promisifyAll","require","mkdir","ls","error","ideQueryFindAll","obj","args","context","console","log","resolve","readdirAsync","files","length","all","map","file","readFileAsync","content","contentParse","JSON","parse","results","stringify","queries","ideQueryHistoryFindAll","db","defaults","history","write","get","value"],"mappings":"AAAA;;;;;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AACA,IAAMA,KAAK,mBAASC,YAAT,CAAsBC,QAAQ,IAAR,CAAtB,CAAX;IACQC,K,qBAAAA,K;IAAOC,E,qBAAAA,E;IAAIC,K,qBAAAA,K;kBAEJ;AACbC;AAAA,yDAAiB,kBAAOC,GAAP,EAAYC,IAAZ,EAAkBC,OAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAEbL;;AAFa,mBAGTC,OAHS;AAAA;AAAA;AAAA;;AAIXF;AACAO,sBAAQC,GAAR,CAAY,2BAAZ;AALW,gDAMJ,mBAASC,OAAT,CAAiB,EAAjB,CANI;;AAAA;AAAA;AAAA,qBAQSZ,GAAGa,YAAH,4BART;;AAAA;AAQLC,mBARK;;AAAA,oBAWTA,MAAMC,MAAN,GAAe,CAXN;AAAA;AAAA;AAAA;;AAAA;AAAA,qBAYC,mBAASC,GAAT,CACJF,MAAMG,GAAN;AAAA,sEAAU,iBAAMC,IAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iCAEgBlB,GAAGmB,aAAH,oCACED,IADF,EAEpB,MAFoB,CAFhB;;AAAA;AAEAE,iCAFA;AAOAC,sCAPA,GAOeC,KAAKC,KAAL,CAAWH,OAAX,CAPf;AAAA,2DAQCC,aAAaG,OAAb,gBAEAH,YAFA;AAGHG,qCAASF,KAAKG,SAAL,CAAeJ,aAAaG,OAA5B;AAHN,+BAKHH,YAbE;;AAAA;AAAA;AAAA;;AAeNX,kCAAQC,GAAR;;AAfM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAAV;;AAAA;AAAA;AAAA;AAAA,kBADI,CAZD;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA,6BAgCL,mBAASC,OAAT,CAAiB,EAAjB,CAhCK;;AAAA;AAULc,qBAVK;AAAA,gDAiCJA,OAjCI;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAjB;;AAAA;AAAA;AAAA;AAAA,KADa;;AAyCbC,wBAzCa,kCAyCWpB,GAzCX,EAyCgBC,IAzChB,EAyCsBC,OAzCtB,EAyC+B;AAC1C,QAAMmB,KAAK,mDAAX;AACAA,OAAGC,QAAH,CAAY,EAAEC,SAAS,EAAX,EAAZ,EAA6BC,KAA7B;AACA,WAAOH,GAAGI,GAAH,CAAO,SAAP,EAAkBC,KAAlB,EAAP;AACD;AA7CY,C","file":"resolverQuery-ide-query.js","sourcesContent":["'use strict';\nimport Bluebird from 'bluebird';\nimport shell from 'shelljs';\nimport low from 'lowdb';\nimport { QUERY_DIRECTORY, QUERY_HISTORY_FILE } from '../../../constants';\nconst fs = Bluebird.promisifyAll(require('fs'));\nconst { mkdir, ls, error } = shell;\n\nexport default {\n  ideQueryFindAll: async (obj, args, context) => {\n    try {\n      ls(QUERY_DIRECTORY);\n      if (error()) {\n        mkdir(QUERY_DIRECTORY);\n        console.log('Created queries directory');\n        return Bluebird.resolve([]);\n      } else {\n        const files = await fs.readdirAsync(QUERY_DIRECTORY);\n\n        const queries =\n          files.length > 0\n            ? await Bluebird.all(\n                files.map(async file => {\n                  try {\n                    const content = await fs.readFileAsync(\n                      `${QUERY_DIRECTORY}/${file}`,\n                      'utf8'\n                    );\n\n                    const contentParse = JSON.parse(content);\n                    return contentParse.results\n                      ? {\n                        ...contentParse,\n                        results: JSON.stringify(contentParse.results)\n                      }\n                      : contentParse;\n                  } catch (error) {\n                    console.log(error);\n                  }\n                })\n              )\n            : Bluebird.resolve([]);\n        return queries;\n      }\n    } catch (error) {\n      return error;\n    }\n  },\n\n  ideQueryHistoryFindAll (obj, args, context) {\n    const db = low(QUERY_HISTORY_FILE);\n    db.defaults({ history: [] }).write();\n    return db.get('history').value();\n  }\n};\n"]}