{"version":3,"sources":["../../src/middleware/security-middleware.js"],"names":["security","app","disable","appWhitelist","locals","whitelist","localHosts","Array","apply","length","map","Number","call","corsOptions","origin","callback","originIsWhitelisted","indexOf","use","options","get","contentSecurityPolicy","directives","defaultSrc","scriptSrc","styleSrc","imgSrc","connectSrc","fontSrc","objectSrc","mediaSrc","frameSrc","xssFilter","frameguard","hsts","maxAge","includeSubdomains","noSniff","ieNoOpen","hidePoweredBy","dnsPrefetchControl"],"mappings":";;;;;kBAQwBA,Q;;AAJxB;;;;AACA;;;;;;oMALA;;;;AAQe,SAASA,QAAT,CAAmBC,GAAnB,EAAwB;AACrCA,MAAIC,OAAJ,CAAY,cAAZ;;AAEA;AACA,MAAMC,eAAeF,IAAIG,MAAJ,CAAWC,SAAX,GAAuBJ,IAAIG,MAAJ,CAAWC,SAAlC,GAA8C,EAAnE;AACA,MAAMC,aAAaC,MAAMC,KAAN,CAAY,IAAZ,EAAkB,EAACC,QAAQ,IAAT,EAAlB,EAAkCC,GAAlC,CAAsCC,OAAOC,IAA7C,EAAmD,UAACD,MAAD;AAAA,iCAAgCA,MAAhC;AAAA,GAAnD,CAAnB;;AAEA,MAAIN,yCACCF,YADD,sBAECG,UAFD,EAAJ;;AAKA,MAAMO,cAAc;AAClBC,YAAQ,gBAAUA,OAAV,EAAkBC,QAAlB,EAA4B;AAClC,UAAIC,sBAAsBX,UAAUY,OAAV,CAAkBH,OAAlB,MAA8B,CAAC,CAAzD;AACAC,eAAS,IAAT,EAAeC,mBAAf;AACD;AAJiB,GAApB;;AAOAf,MAAIiB,GAAJ,CAAQ,oBAAKL,WAAL,CAAR;;AAEA;AACAZ,MAAIkB,OAAJ,CAAY,GAAZ,EAAiB,oBAAKN,WAAL,CAAjB;;AAGA;AACA,MAAIZ,IAAImB,GAAJ,CAAQ,KAAR,MAAmB,aAAvB,EAAsC;AACpCnB,QAAIiB,GAAJ,CAAQ,iBAAOG,qBAAP,CAA6B;AACnCC,kBAAa;AACXC,oBAAY,CAAC,MAAD,CADD;AAEXC,mBAAW,CAAC,wBAAD,CAFA;AAGXC,kBAAU,CAAC,eAAD,CAHC;AAIXC,gBAAQ,CAAC,wBAAD,CAJG;AAKXC,oBAAY,CAAC,MAAD,CALD;AAMXC,iBAAS,EANE;AAOXC,mBAAW,EAPA;AAQXC,kBAAU,EARC;AASXC,kBAAU;AATC;AADsB,KAA7B,CAAR;AAaD;;AAGD9B,MAAIiB,GAAJ,CAAQ,iBAAOc,SAAP,EAAR;AACA/B,MAAIiB,GAAJ,CAAQ,iBAAOe,UAAP,EAAR;AACAhC,MAAIiB,GAAJ,CAAQ,iBAAOgB,IAAP,CAAY;AAClBC,YAAQ,UADU;AAElBC,uBAAmB;AAFD,GAAZ,CAAR;AAIAnC,MAAIiB,GAAJ,CAAQ,iBAAOmB,OAAP,EAAR;AACApC,MAAIiB,GAAJ,CAAQ,iBAAOoB,QAAP,EAAR;AACArC,MAAIiB,GAAJ,CAAQ,iBAAOqB,aAAP,EAAR;AACAtC,MAAIiB,GAAJ,CAAQ,iBAAOsB,kBAAP,EAAR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACD","file":"security-middleware.js","sourcesContent":["/*\n* Application security\n*/\n\nimport helmet from 'helmet';\nimport cors from 'cors';\n\n\nexport default function security (app) {\n  app.disable('x-powered-by');\n\n  // add localhost to white list\n  const appWhitelist = app.locals.whitelist ? app.locals.whitelist : [];\n  const localHosts = Array.apply(null, {length: 9999}).map(Number.call, (Number) => `http://localhost:${Number}`);\n\n  let whitelist = [\n    ...appWhitelist,\n    ...localHosts\n  ];\n\n  const corsOptions = {\n    origin: function (origin, callback) {\n      var originIsWhitelisted = whitelist.indexOf(origin) !== -1;\n      callback(null, originIsWhitelisted);\n    }\n  };\n\n  app.use(cors(corsOptions));\n\n  // pre-flight\n  app.options('*', cors(corsOptions));\n\n\n  // Content Security Policy\n  if (app.get('env') !== 'development') {\n    app.use(helmet.contentSecurityPolicy({\n      directives : {\n        defaultSrc: ['self'],\n        scriptSrc: ['*.google-analytics.com'],\n        styleSrc: ['unsafe-inline'],\n        imgSrc: ['*.google-analytics.com'],\n        connectSrc: ['none'],\n        fontSrc: [],\n        objectSrc: [],\n        mediaSrc: [],\n        frameSrc: []\n      }\n    }));\n  }\n\n\n  app.use(helmet.xssFilter());\n  app.use(helmet.frameguard());\n  app.use(helmet.hsts({\n    maxAge: 7776000000,\n    includeSubdomains: true\n  }));\n  app.use(helmet.noSniff());\n  app.use(helmet.ieNoOpen());\n  app.use(helmet.hidePoweredBy());\n  app.use(helmet.dnsPrefetchControl());\n  // app.use(require('express-enforces-ssl'));\n  // app.use(helmet.hpkp({\n  //   maxAge: ninetyDaysInMilliseconds,\n  //   sha256s: ['AbCdEf123=', 'ZyXwVu456='],\n  //   includeSubdomains: true,         // optional\n  //   reportUri: 'http://example.com'  // optional\n  //   reportOnly: false,               // optional\n  //\n  //   // Set the header based on a condition.\n  //   // This is optional.\n  //   setIf: function (req, res) {\n  //     return req.secure\n  //   }\n  // }))\n};\n"]}